---
- name: Push network config file to the conversion host
  ansible.builtin.copy:
    src: "network_config.sh"
    dest: "{{ os_migrate_data_dir }}/network_config.sh"
    mode: '0755'
  when:
    - os_migrate_configure_network|default(false)|bool
    - target_os == 'rhel'

- name: Migrate Guest from Vmware using nbdkit
  os_migrate.vmware_migration_kit.migrate.migrate:
    dst_cloud: "{{Â dst_cloud }}"
    user:  "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    server: "{{ vcenter_hostname }}"
    vmname: "{{ vm_name }}"
    osmdatadir: "{{ os_migrate_data_dir }}"
    # cbtsync: "{{ cbt_sync }} | default(false) | bool"
    # convhostname: "{{ conv_host_name }} | default(omit) }}"
  register: migrate_output

- name: Set fact for disk ID
  set_fact:
    volume_uuid: "{{ migrate_output.id }}"
